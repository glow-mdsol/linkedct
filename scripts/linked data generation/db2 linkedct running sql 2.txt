DROP table cttrials;
CREATE table cttrials (
	id	CHAR(11) NOT NULL,
	download_date 		VARCHAR(100),
	link_text 		VARCHAR(200),
	url 			VARCHAR(150),
	org_study_id 		VARCHAR(50),
	nct_id 			VARCHAR(50),
	brief_title 		VARCHAR(600),
	acronym 		VARCHAR(50),
	official_title 		VARCHAR(600),
	lead_sponsor_agency	VARCHAR(150),
	source 			VARCHAR(150),
	has_dmc 		VARCHAR(100),
	overall_status 		VARCHAR(100),
	why_stopped 		VARCHAR(300),
	phase 			VARCHAR(100),
	study_type 		VARCHAR(200),
	study_design 		VARCHAR(200),
	number_of_arms 		INTEGER,
	number_of_groups 	INTEGER,
	enrollment 		INTEGER,
	biospec_retention 	VARCHAR(200),
	eligibility_study_pop 		VARCHAR(2000),
	eligibility_sampling_method	VARCHAR(200),
	eligibility_gender 		VARCHAR(20),
	eligibility_minimum_age 	VARCHAR(20),
	eligibility_maximum_age 	VARCHAR(20),
	eligibility_healthy_volunteers 	VARCHAR(200),
	overall_contact_first_name 		VARCHAR(100),
	overall_contact_middle_name 		VARCHAR(50),
	overall_contact_last_name 		VARCHAR(150),
	overall_contact_degrees 		VARCHAR(200),
	overall_contact_phone 			VARCHAR(100),
	overall_contact_phone_ext 		VARCHAR(100),
	overall_contact_email 			VARCHAR(250),
	start_date 			VARCHAR(100),
	end_date  			VARCHAR(100),
	primary_completion_date 	VARCHAR(100),
	verification_date 		VARCHAR(100),
	lastchanged_date 		VARCHAR(100),
	firstreceived_date 		VARCHAR(100),
	PRIMARY KEY(id)
);

INSERT into cttrials
SELECT CT.id, X.*
FROM (select * from ADMIN.CTXMLNEW) AS CT,
     XMLTABLE('$doc/clinical_study' PASSING BY REF trial AS "doc"
       COLUMNS
	download_date 		VARCHAR(100) 	PATH './required_header/download_date',
	link_text 			VARCHAR(200) 	PATH './required_header/link_text',
	url 				VARCHAR(150) 	PATH './required_header/url',
	org_study_id 		VARCHAR(50) 	PATH './id_info/org_study_id',
	nct_id 				VARCHAR(50) 	PATH './id_info/nct_id',
	brief_title 		VARCHAR(600)	PATH './brief_title',
	acronym 			VARCHAR(50) 	PATH './acronym',
	official_title 		VARCHAR(600) 	PATH './official_title',
	lead_sponsor_agency	VARCHAR(150) 	PATH './sponsors/lead_sponsor/agency',
	source 				VARCHAR(150) 	PATH './source',
	has_dmc 			VARCHAR(100) 	PATH './oversight_info/has_dmc',
	overall_status 		VARCHAR(100) 	PATH './overall_status',
	why_stopped 		VARCHAR(300) 	PATH './why_stopped',
	phase 				VARCHAR(100) 	PATH './phase',
	study_type 			VARCHAR(200) 	PATH './study_type',
	study_design 		VARCHAR(200) 	PATH './study_design',
	number_of_arms 		INTEGER 	PATH './number_of_arms',
	number_of_groups 	INTEGER 	PATH './number_of_groups',
	enrollment 			INTEGER 	PATH './enrollment',
	biospec_retention 	VARCHAR(200) 	PATH './biospec_retention',
	eligibility_study_pop 		VARCHAR(2000) 	PATH './eligibility/study_pop',
	eligibility_sampling_method	VARCHAR(200)	PATH './eligibility/sampling_method',
	eligibility_gender 			VARCHAR(20) 	PATH './eligibility/gender',
	eligibility_minimum_age 	VARCHAR(20) 	PATH './eligibility/minimum_age',
	eligibility_maximum_age 	VARCHAR(20) 	PATH './eligibility/maximum_age',
	eligibility_healthy_volunteers 	VARCHAR(200) 	PATH './eligibility/healthy_volunteers',
	overall_contact_first_name 		VARCHAR(100)	PATH './overall_contact/first_name',
	overall_contact_middle_name 	VARCHAR(50)	PATH './overall_contact/middle_name',
	overall_contact_last_name 		VARCHAR(150)	PATH './overall_contact/last_name',
	overall_contact_degrees 		VARCHAR(200)	PATH './overall_contact/degrees',
	overall_contact_phone 			VARCHAR(100)	PATH './overall_contact/phone',
	overall_contact_phone_ext 		VARCHAR(100)	PATH './overall_contact/phone_ext',
	overall_contact_email 			VARCHAR(250)	PATH './overall_contact/email',
	start_date 					VARCHAR(100)	PATH './start_date',
	end_date  					VARCHAR(100)	PATH './end_date',
	primary_completion_date 	VARCHAR(100)	PATH './primary_completion_date',
	verification_date 			VARCHAR(100)	PATH './verification_date',
	lastchanged_date 			VARCHAR(100)	PATH './lastchanged_date',
	firstreceived_date 			VARCHAR(100)	PATH './firstreceived_date'
           ) AS X;
